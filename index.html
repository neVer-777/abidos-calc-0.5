<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Abidos Kalkulation</title>
  <link rel="manifest" href="manifest.webmanifest">
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }
  </script>
  <style>
    body { font-family: Arial, sans-serif; padding: 1rem; max-width: 800px; margin: auto; }
    h1 { font-size: 1.5rem; }
    input[type="number"] { width: 100%; padding: 0.5rem; margin-bottom: 0.5rem; font-size: 1rem; }
    input:focus { outline: 2px solid #007bff; }
    button { padding: 1rem; background: #007bff; color: white; font-size: 1rem; width: 100%; border: none; cursor: pointer; margin-top: 1rem; }
    button:hover { background: #0056b3; }
    .results { margin-top: 2rem; }
    .section { margin-bottom: 2rem; }
    .calculation { background: #f9f9f9; padding: 1rem; border: 1px solid #ccc; white-space: pre-wrap; font-family: monospace; }
  </style>
</head>
<body>
  <h1>Abidos Kalkulation (v0.5 FINAL)</h1>

  <div class="section">
    <h2>Eingaben</h2>
    <label>Preis Timber (pro 100): <input id="priceTimber" type="number" step="0.01"></label>
    <label>Menge Timber: <input id="qtyTimber" type="number"></label>
    <label>Preis Tender Timber (pro 100): <input id="priceTender" type="number" step="0.01"></label>
    <label>Menge Tender Timber: <input id="qtyTender" type="number"></label>
    <label>Preis Abidos Timber (pro 100): <input id="priceAbidos" type="number" step="0.01"></label>
    <label>Menge Abidos Timber: <input id="qtyAbidos" type="number"></label>
    <label>Preis Abidos Fusion (pro St√ºck): <input id="priceFusion" type="number" step="0.01"></label>
    <label>Menge Abidos Fusion: <input id="qtyFusion" type="number"></label>
    <label>Herstellungskosten Fusion (f√ºr 10 St√ºck): <input id="craftingCost" type="number" value="364"></label>
  </div>

  <button onclick="calculate()">Berechnen</button>

  <div class="results">
    <div class="section">
      <h2>üîÅ Vergleichsrechnung</h2>
      <div id="resultCompare" class="calculation"></div>
    </div>

    <div class="section">
      <h2>üì¶ Verkaufsrechnung Lagerbestand</h2>
      <div id="resultStock" class="calculation"></div>
    </div>
  </div>

  <script>
    const inputs = document.querySelectorAll("input");
    inputs.forEach(input => {
      input.addEventListener("focus", () => input.select());
      const saved = localStorage.getItem(input.id);
      if (saved) input.value = saved;
    });

    function formatNumber(n) {
      return Number(n).toLocaleString("de-DE", { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function calculate() {
      inputs.forEach(input => localStorage.setItem(input.id, input.value));

      const timberPrice = parseFloat(priceTimber.value) / 100;
      const tenderPrice = parseFloat(priceTender.value) / 100;
      const abidosPrice = parseFloat(priceAbidos.value) / 100;
      const fusionPrice = parseFloat(priceFusion.value);
      const craftingCost = parseFloat(craftingCost.value);

      const timberQty = parseFloat(qtyTimber.value);
      const tenderQty = parseFloat(qtyTender.value);
      const abidosQty = parseFloat(qtyAbidos.value);
      const fusionQty = parseFloat(qtyFusion.value);

      // Vergleichsrechnung
      const timberNeeded = 86;
      const tenderNeeded = 45;
      const abidosNeeded = 33;
      const fusionCount = 10;

      const rawSaleGross = (timberNeeded * timberPrice) + (tenderNeeded * tenderPrice) + (abidosNeeded * abidosPrice);
      const rawSaleNet = rawSaleGross * 0.95;

      const fusionGross = fusionCount * fusionPrice;
      const fusionNet = (fusionGross - craftingCost) * 0.95;

      let resultCompare = `Abidos Fusion (Herstellung & Verkauf von ${fusionCount} St√ºck):
` +
                          `  Brutto: ${formatNumber(fusionGross)} Gold
` +
                          `  - Herstellungskosten: ${formatNumber(craftingCost)} Gold
` +
                          `  = Zwischensumme: ${formatNumber(fusionGross - craftingCost)} Gold
` +
                          `  - 5% Verkaufsgeb√ºhr: ${formatNumber((fusionGross - craftingCost) * 0.05)} Gold
` +
                          `  ‚ûú Nettoerl√∂s: ${formatNumber(fusionNet)} Gold

` +

                          `Alternativverkauf der Rohstoffe:
` +
                          `  Timber (${timberNeeded}): ${formatNumber(timberNeeded * timberPrice)} Gold
` +
                          `  Tender Timber (${tenderNeeded}): ${formatNumber(tenderNeeded * tenderPrice)} Gold
` +
                          `  Abidos Timber (${abidosNeeded}): ${formatNumber(abidosNeeded * abidosPrice)} Gold
` +
                          `  ‚ûú Brutto: ${formatNumber(rawSaleGross)} Gold
` +
                          `  ‚ûú Netto (abzgl. 5%): ${formatNumber(rawSaleNet)} Gold

`;

      if (fusionNet > rawSaleNet) {
        resultCompare += `‚úÖ Herstellung & Verkauf von Abidos Fusion ist lukrativer (+${formatNumber(fusionNet - rawSaleNet)} Gold)`;
      } else {
        resultCompare += `‚úÖ Verkauf der Rohstoffe ist lukrativer (+${formatNumber(rawSaleNet - fusionNet)} Gold)`;
      }

      resultCompareEl.innerText = resultCompare;

      // Lagerverkaufsrechnung
      const items = [
        { name: "Timber", qty: timberQty, price: timberPrice, unit: 100 },
        { name: "Tender Timber", qty: tenderQty, price: tenderPrice, unit: 100 },
        { name: "Abidos Timber", qty: abidosQty, price: abidosPrice, unit: 100 },
        { name: "Abidos Fusion", qty: fusionQty, price: fusionPrice, unit: 1 }
      ];

      let totalNet = 0;
      let resultStock = "";

      items.forEach(item => {
        const gross = (item.qty / item.unit) * item.price;
        const net = gross * 0.95;
        totalNet += net;
        resultStock += `${item.name} (${item.qty} St√ºck):
` +
                       `  ‚ûú Bruttoerl√∂s: ${formatNumber(gross)} Gold
` +
                       `  ‚ûú Nettoerl√∂s (abzgl. 5%): ${formatNumber(net)} Gold

`;
      });

      resultStock += `üí∞ Gesamter Nettoerl√∂s: ${formatNumber(totalNet)} Gold`;
      resultStockEl.innerText = resultStock;
    }
  </script>
</body>
</html>